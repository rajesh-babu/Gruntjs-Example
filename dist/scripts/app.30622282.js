function concat(a,b){return a+b}!function(){var a=function(){function a(){o(),alert("Task added successfully","Task added"),document.forms.add.desc.value="",document.forms.add.due_date.value="",location.hash="#list"}var b=function(){setTimeout(function(){window.scrollTo(0,0)},1e3)},c=function(){switch(location.hash){case"#add":document.body.className="add";break;case"#settings":document.body.className="settings";break;default:document.body.className="list"}b()};c(),window.addEventListener("hashchange",c,!1),window.addEventListener("orientationchange",b,!1);var d="localStorage"in window,e=function(){if(d){var a=localStorage.getItem("name"),b=localStorage.getItem("colorScheme"),c=document.getElementById("user_name"),e=document.forms.settings.name,f=document.documentElement,g=document.forms.settings.color_scheme;a?(c.innerHTML=a+"'s",e.value=a):(c.innerHTML="My",e.value=""),b?(f.className=b.toLowerCase(),g.value=b):(f.className="blue",g.value="Blue")}},f=function(a){if(a.preventDefault(),d){var b=document.forms.settings.name.value;if(b.length>0){var c=document.forms.settings.color_scheme.value;localStorage.setItem("name",b),localStorage.setItem("colorScheme",c),e(),alert("Settings saved successfully","Settings saved"),location.hash="#list"}else alert("Please enter your name","Settings error")}else alert("Browser does not support localStorage","Settings error")},g=function(a){a.preventDefault(),confirm("This will erase all data. Are you sure?","Reset data")&&(d&&localStorage.clear(),e(),alert("Application data has been reset","Reset successful"),location.hash="#list",t())};e(),document.forms.settings.addEventListener("submit",f,!1),document.forms.settings.addEventListener("reset",g,!1);var h,i=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB||!1,j=window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.msIDBKeyRange||!1,k="openDatabase"in window,l=function(){if(i){var a=i.open("tasks",1),b="onupgradeneeded"in a;a.onsuccess=function(a){if(h=a.target.result,b||"1"==h.version)o();else{var c=h.setVersion("1");c.onsuccess=function(){var a=h.createObjectStore("tasks",{keyPath:"id"});a.createIndex("desc","descUpper",{unique:!1}),o()}}},b&&(a.onupgradeneeded=function(a){h=a.target.result;var b=h.createObjectStore("tasks",{keyPath:"id"});b.createIndex("desc","descUpper",{unique:!1})})}else k&&(h=openDatabase("tasks","1.0","Tasks database",5242880),h.transaction(function(a){var b="CREATE TABLE IF NOT EXISTS tasks (id INTEGER PRIMARY KEY ASC,desc TEXT,due DATETIME,complete BOOLEAN)";a.executeSql(b,[],o)}))};l();var m=function(a,b){var c=document.createElement("li");c.innerHTML=a.length>0?'<div class="item_title">No tasks match your query <strong>'+a+"</strong>.</div>":'<div class="item_title">No tasks to display. <a href="#add">Add one</a>?</div>',b.appendChild(c)},n=function(a,b){var c=document.createElement("li"),d=1==a.complete?' checked="checked"':"";c.innerHTML='<div class="item_complete"><input type="checkbox" name="item_complete" id="chk_'+a.id+'"'+d+'></div><div class="item_delete"><a href="#" id="del_'+a.id+'">Delete</a></div><div class="item_title">'+a.desc+'</div><div class="item_due">'+a.due+"</div>",b.appendChild(c);var e=function(b){b.preventDefault();var c={id:a.id,desc:a.desc,descUpper:a.desc.toUpperCase(),due:a.due,complete:b.target.checked};r(c)},f=function(b){b.preventDefault(),confirm("Deleting task. Are you sure?","Delete")&&s(a.id)};document.getElementById("chk_"+a.id).onchange=e,document.getElementById("del_"+a.id).onclick=f},o=function(a){var b=document.getElementById("task_list"),c=a||"";if(b.innerHTML="",i){var d,e=h.transaction(["tasks"],"readonly"),f=e.objectStore("tasks"),g=0;if(c.length>0){var l=f.index("desc"),o=c.toUpperCase(),p=j.bound(o,o+"z");d=l.openCursor(p)}else d=f.openCursor();d.onsuccess=function(a){var c=a.target.result;null!=c&&(g++,n(c.value,b),c["continue"]())},e.oncomplete=function(){0==g&&m(c,b)}}else k&&h.transaction(function(a){var d,e=[];c.length>0?(d="SELECT * FROM tasks WHERE desc LIKE ?",e[0]=c+"%"):d="SELECT * FROM tasks";var f=function(a,d){for(var e=0,f=d.rows.length;f>e;e++)n(d.rows.item(e),b);0===f&&m(c,b)};a.executeSql(d,e,f)})},p=function(a){a.preventDefault();var b=document.forms.search.query.value;b.length>0?o(b):o()};document.forms.search.addEventListener("submit",p,!1);var q=function(b){b.preventDefault();var c=document.forms.add.desc.value,d=document.forms.add.due_date.value;if(c.length>0&&d.length>0){var e={id:(new Date).getTime(),desc:c,descUpper:c.toUpperCase(),due:d,complete:!1};if(i){{var f=h.transaction(["tasks"],"readwrite"),g=f.objectStore("tasks");g.add(e)}f.oncomplete=a}else k&&h.transaction(function(b){var c="INSERT INTO tasks(desc, due, complete) VALUES(?, ?, ?)",d=[e.desc,e.due,e.complete];b.executeSql(c,d,a)})}else alert("Please fill out all fields","Add task error")};document.forms.add.addEventListener("submit",q,!1);var r=function(a){if(i){var b=h.transaction(["tasks"],"readwrite"),c=b.objectStore("tasks");c.put(a)}else if(k){var d=a.complete?1:0;h.transaction(function(b){var c="UPDATE tasks SET complete = ? WHERE id = ?",e=[d,a.id];b.executeSql(c,e)})}},s=function(a){if(i){{var b=h.transaction(["tasks"],"readwrite"),c=b.objectStore("tasks");c["delete"](a)}b.oncomplete=o}else k&&h.transaction(function(b){var c="DELETE FROM tasks WHERE id = ?",d=[a];b.executeSql(c,d,o)})},t=function(){if(i){var a=i.deleteDatabase("tasks");a.onsuccess=window.location.reload()}else k&&h.transaction(function(a){var b="DELETE FROM tasks";a.executeSql(b,[],o)})};if("applicationCache"in window){var u=window.applicationCache;u.addEventListener("updateready",function(){u.swapCache(),confirm("App update is available. Update now?")&&w.location.reload()},!1)}};window.addEventListener("load",function(){new a},!1)}();